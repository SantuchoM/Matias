<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="CSS/stylePage.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
    <title>El viaje de Matias</title>
    <script src="JS/d3v4+jetpack.js"></script>
    <script src="JS/graph-scroll.js"></script>
    <script src= "https://d3js.org/d3.v4.min.js"></script>
    <script src="JS/topojson.v1.min.js"></script>
    <script src="JS/d3-array.v1.min.js"></script>
    <script src="JS/d3-geo.v1.min.js"></script>
    <script src="JS/d3-geo-projection.v2.min.js"></script>
  </head>

  <body>

    <div id="contenedor">

      <div id="mapaElevador" class="mapa">
      </div>

      <div id="portada">
        <h1>El viaje de Matias</h1>
        <br><br><br><br>
          <img src="IMG/matias.png" alt="" id="matias">
        <br><br><br><br>
          <p id="txtintro">
            Matías es un angoleño de 41 años, padre de 4 hijos. En 2019, emprendió un viaje que lo llevó a las orillas del país más rico del mundo. Su recorrido es un testimonio de un mundo globalizado donde decisiones estatales, el pragmatismo económico y cinismo político afectan dramáticamente las condiciones de vida de miles de personas.<br><br>Les proponemos seguir las etapas de la odisea de Matías en África y América Latina, revelando una ruta migratoria del sur global, trastornada por la Pandemia.
          </p>
      </div>

      <div id="introduccion">
        <h2>Angola, país de origen de Matías</h2>
        <p>
          Antes de empezar su viaje, Matías trabajaba en la industria petrolera, sobre las plataformas que salpican el horizonte del litoral angoleño. Este trabajo le permitió mantener un estatus de vida alto, pudiendo incluso comprarse un departamento en Luanda, capital de Angola y, en aquel entonces, la ciudad más cara de África. Estas buenas condiciones de vida empezaron a degradarse en 2017, año de transición política y de crisis económica en el Estado angoleño.
        </p>
      </div>

      <div id="espacio">
      </div>

      <div id="viaje">
        <div class="paradas">
          <h2>Cabinda</h2>
          <p>
            El viaje de Matias empieza en Cabinda, un territorio exclave de Angola donde, desde la independencia del país, existe una guerrilla separatista y donde, al mismo tiempo, se produce el 80% del petróleo angoleño. Por formar parte de una asociación a favor de una mayor autonomía del territorio, Matias y sus compañeros de lucha fueron encarcelados en una prisión militar en Febrero del 2019. Prisión de la cual Matías logró escapar en la noche, para luego cruzar clandestinamente la frontera con el Congo (R.D.C.).
          </p>
          <img src="IMG/cabinda.png" alt="" width="100%">
        </div>
        <div class="paradas">
          <h2>Luanda</h2>
          <p>
            Después de cruzar el Congo, Matías regresó a Luanda, donde se habían quedado su pareja y sus hijos. Perseguidos por los servicios de inteligencia del estado y en un contexto económico muy desfavorable, tuvieron que vender a pérdida su departamento. Desde 2015, Angola atraviesa una profunda crisis económica, ocasionada por la caída de los precios del petróleo, provocando una inflación mensual de 25%. Esta situación empeoró cuando el estado decidió, por razones políticas, bloquear todas las transacciones financieras con el exterior del país. Con el dinero que lograron reunir la familia huyó hacía Namibia, país situado un poco más al sur.
          </p>
        </div>
        <div class="paradas">
          <h2>Windhoek</h2>
          <p>
            Al llegar a Windhoek, Matías no tenía una idea clara de lo que podía, quería o debía hacer. De forma evidente, era sumamente complicado y peligroso viajar con la familia entera: el mes de abril, su pareja había dado a luz a una niña y sus otros hijos tenían entre cinco y once años. La pareja decidió que Matías intentaría llegar solo a Estados Unidos y para ello, sería necesario tramitar una visa en la embajada estadounidense de Luanda. Así, Matías regresó de incógnito a Angola, a la colonia más vigilada de la capital para que finalmente su solicitud fuera rechazada. De regreso a Windhoek, se enteró gracias a un pastor angoleño refugiado que muchos compatriotas habían logrado viajar hasta Panamá.<br><br>¿Por qué no intentar lo mismo?
          </p>
        </div>
        <div class="paradas">
          <h2>Adís Abeba</h2>
          <p>
            Matías consiguió finalmente un boleto de avión a Ecuador y decidió que haría el resto del camino por tierra. En su viaje, hizo escala en Etiopía y en Brasil. En las últimas dos décadas, Adís Abeba, capital de Etiopía, se volvió un nodo indispensable del tráfico aéreo en la región subsahariana de África. Este desarrollo estratégico ha llevado a otros países como Brasil y países europeos a ejercer presión sobre el Estado etiope para que frene el número de personas que buscan el exilio.
          </p>
        </div>
        <div class="paradas">
          <h2>São Paulo</h2>
          <p>
            Brasil, la segunda parada de la travesía del Atlántico, comparte con Angola el uso del portugues y hubiera podido ser un destino ideal para Matías. Sin embargo la crisis que atraviesa y la política xenófoba del presidente Bolsonaro ha estado expulsando a un número importante de exiliados africanos y caribeños.
          </p>
        </div>
        <div class="paradas">
          <h2>Quito</h2>
          <p>
            Matías llegó entonces a Quito, Ecuador, en Junio de 2019. Durante una década, el ex presidente Rafael Correa desarrolló una política basada en la idea de la “ciudadanía universal”: cualquier persona podía entrar, salir, transitar o trabajar en Ecuador. Al inicio esta ley buscaba otorgar una protección legal a los ecuatorianos emigrados pero permitió a miles de personas de orígenes tan diversos como afganos, filipinos o cameruneses transitar en condiciones seguras por el país andino.
          </p>
          <img src="IMG/graficoEcuador.png" alt="" width="100%">
          <p>
            De este modo, se estima que entre 35,000 y 40,000 africanos de diversos países entraron a Ecuador entre 2008 y 2018. A finales de 2019, el nuevo presidente Lenin Moreno, de corte conservador, puso un término a esta política.
          </p>
        </div>
        <div class="paradas">
          <h2>El Darién</h2>
          <p>
            En Quito, Matias conoció a otros angoleños que estaban saliendo de Brasil y que se dirigían hacía el norte. Se sumó a este grupo, haciéndose muy amigo de ellos. En algunos días, cruzaron a Colombia y llegaron a la costa caribeña, donde se subieron a lanchas para llegar a Capurganá, la punta norte de la región aislada del Chocó: la puerta de entrada al Darién. El Darién es la selva fronteriza entre Colombia y Panamá, un espacio tan inhóspito que es el único lugar donde se corta la carretera Panamericana. En esta zona del istmo se cruzan rutas de migración, de tráfico de droga, tráfico de armas y de grupos paramilitares. En pocas palabras, es uno de los lugares más peligrosos del camino, donde los migrantes se enferman, se pierden o tienen la mala fortuna de toparse en el camino con grupos criminales. Para cruzar, Matias y su grupo, compuesto de personas originarias de Bangladesh, Nepal, Yemen, Camerún, Congo y Angola, pagaron a un pollero que los llevó a la entrada de la selva y que después los dejó solos. El grupo se dispersó en la selva. Matías logró cruzar en 5 días, quedándose con un angoleño y su hijo.
          </p>
          <img src="IMG/darien.png" alt="" width="100%">
        </div>
        <div class="paradas">
          <h2>San José</h2>
          <p>
            Cuando Matías salió de la selva, estaba cansado y enfermo, con terribles dolores de cabeza,  pero pensaba haber llegado a su destino final, Panamá. Fue una desilusión: el país centroamericano ya no recibía solicitudes de refugio y el ejército obligaba a los migrantes a salir del país. Muy debilitado, Matías cruzó la frontera con Costa Rica y llegó a San José, a un campo de refugiados de la Cruz Roja. En este campo, Matías se quedó un mes, pudo descansar y recuperarse un poco. Tras este periodo de incertidumbre, Matías decidió finalmente seguir hacia México y después Estados Unidos.
          </p>
        </div>
        <div class="paradas">
          <h2>Tapachula</h2>
          <p>
            Matías cruzó el Suchiate, el río entre México y Guatemala, en Agosto 2019.
          </p>
          <img src="IMG/suchiate.png" alt="" width="100%">
          <p>
            Cuando llegó la frontera estaba en ebullición, Donald Trump empezaba a presionar al gobierno mexicano para que controle el flujo de migrantes en la frontera sur. México cedió al chantaje norteamericano y envió a la Guardia Nacional a las fronteras, impidiendo el pasaje de miles de personas y deportando a los centroamericanos que llegaban. En este contexto, los migrantes africanos se vieron atrapados en una situación insoluble: el Estado mexicano les impedía el paso pero sin deportarlos y sin proponer otras opciones. En septiembre más de 6,000 migrantes africanos bloqueados empezaron a protestar, armando un campamento frente a la estación migratoria en Tapachula, la famosa ciudad fronteriza.
          </p>
          <img src="IMG/sigloxxi.png" alt="" width="100%">
          <p>
            Para resolver el problema, a partir de Diciembre de 2019, el Estado mexicano empezó a otorgar papeles a los extracontinentales trabados en Tapachula. Matías recibió una tarjeta de residente permanente que le permitió viajar con seguridad por México, aunque decidió quedarse un tiempo en Tapachula porque le parecía más sencillo organizar el tránsito de familia desde allá. En este contexto empezó la pandemia de Covid-19. La economía de Tapachula, que depende de los flujos de personas, sufrió mucho de las medidas sanitarias. Matías, que mientras tanto había empezado a vivir con una prima lejana y su hijo recién llegados, empezó a encontrar menos y menos posibilidades de trabajo.
          </p>
        </div>
        <div class="paradas">
          <h2>Tijuana</h2>
          <p>
            El proceso legal que Matías buscaba tramitar para traer a su familia a México es una visa de reunion familiar. Aunque en el papel parece sencillo, es un proceso que puede tomar meses y revelarse costoso. Como no había oportunidades de trabajo en Tapachula, Matías decidió seguir el ejemplo de la mayor parte de los migrantes africanos y fue a buscar trabajo en las maquiladoras fronterizas, esperando la oportunidad de pasar a Estados Unidos. Gracias a un compañero camerunés, encontró en septiembre de 2020 un trabajo en Tijuana, en una fábrica de acero.
          </p>
        </div>
      </div>


    </div>

    <div id="conclusion">
      <p>
        Hoy, en abril de 2021, han pasado ya siete meses desde que Matías trabaja en esta fábrica. Si bien ha logrado encontrar cierta estabilidad en Tijuana, aún no ha logrado volver a ver a su esposa o sus hijos. El trámite para reunirse con su familia sigue pero sin gran éxito hasta el momento.
      </p>
    </div>


<script type="text/javascript">

///// DEFINIR LAS ETAPAS EN UN JSON
const camino =
  [
    {Pais:"Angola", Ciudad:"Cabinda", Etapas:"Etapa01", Coordenadas:[-12,5,0]},
    {Pais:"Angola", Ciudad:"Luanda", Etapas:"Etapa02", Coordenadas:[-13,8.5,0]},
    {Pais:"Namibia", Ciudad:"Windhoek", Etapas:"Etapa03", Coordenadas:[-17,22,0]},
    {Pais:"Etiopía", Ciudad:"Adís Abeba", Etapas:"Etapa04", Coordenadas:[-40,-10,0]},
    {Pais:"Brasil", Ciudad:"São Paulo", Etapas:"Etapa05", Coordenadas:[50,20,0]},
    {Pais:"Ecuador", Ciudad:"Quito", Etapas:"Etapa06", Coordenadas:[80,0,0]},
    {Pais:"Panamá", Ciudad:"El Darién", Etapas:"Etapa07", Coordenadas:[77.5,-7.5,0]},
    {Pais:"CostaRica", Ciudad:"San José", Etapas:"Etapa08", Coordenadas:[80,-10,0]},
    {Pais:"México", Ciudad:"Tapachula", Etapas:"Etapa09", Coordenadas:[95,-15,0]},
    {Pais:"México", Ciudad:"Tijuana", Etapas:"Etapa10", Coordenadas:[115,-32,0]}
  ];

///// CONSTRUCCIÓN DEL MAPA
var oldWidth = 0

var width = height = d3.select('#mapaElevador').node().offsetWidth
    active = d3.select(null);

var projection = d3.geoSatellite()
    .scale(1000)
    .translate([width / 2, height / 2])
    .rotate([0, 0, 0])
    .tilt(0)
    .distance(1.4)
    .precision(0.1)
    .clipAngle(Math.acos(1 / 1.4) * 180 / Math.PI)

var path = d3.geoPath()
    .projection(projection);

var svg = d3.select("#mapaElevador").append("svg")
    .attr("width", width)
    .attr("height", height)
  //  .on("click", stopped, true);

  var g = svg.append("g");

  var paises;
  var ciudades;

// Ici commence la contruction de la carte à partir de bases de données
d3.queue() // cette fonction permet de donner une ordre au chargement des couches
.defer(d3.json, "TOPOJSON/paises.json")
.defer(d3.json, "TOPOJSON/ciudades.json")
.defer(d3.json, "TOPOJSON/camino.json")
.await(makeMap);

// Déclencher la carte
    function makeMap(error, world, cities, way) {
      if(error) {
        console.log(error);
      };

      //Adding water
     g.append("path")
      .datum({type: "Sphere"})
      .attr("class", "oceano")
      .attr("d", path);

      //adding countries
      paises = topojson.feature(world, world.objects.paises).features;


      var countries = g.selectAll(".countries")
          .data(paises)
          .enter()
           .append("path")
           .attr("d", path)
           .attr("class", "pais")
           .attr("id", (function(d) { return d.properties.NAME; }));

           caminos = topojson.feature(way, way.objects.camino).features;

           var ruta = g.selectAll(".rutas")
               .data(caminos)
               .enter()
                .append("path")
                .attr("d", path)
                .attr("class", "rutas")
                .attr("id", (function(d) { return d.properties.Etapa; }));


           //adding cities
           ciudades = topojson.feature(cities, cities.objects.ciudades).features;

           var cities = g.selectAll(".cities")
               .data(ciudades)
               .enter()
                .append("circle")
                .attr("cx", function(d) {return projection(d.geometry.coordinates)[0];})
                .attr("cy", function(d) {return projection(d.geometry.coordinates)[1];})
                .attr("r", "4px")
                .attr("id", function(d) {return "C"+d.properties.Etapa;})
                .attr("class", "cities");


      //adding labels

      var labels = g.selectAll(".labels")
              .data(ciudades)
              .enter()
              .append("text")
              .attr("x", function(d){return projection(d.geometry.coordinates)[0];})
              .attr("y", function(d){return projection(d.geometry.coordinates)[1];})
          	  .attr('dy', function(d){
                if (["Tapachula","Windhoek", "São Paulo"].includes(d.properties.Name)) {
                return 21;
              }
              return -7;
              }) // vertical offset
          		.attr('dx', function(d){
                if (["El Darién","Adís Abeba", "San José"].includes(d.properties.Name)) {
                return 7;
              }
              return -7;
              })
              .attr('text-anchor', function(d){
                if (["El Darién","Adís Abeba", "San José"].includes(d.properties.Name)) {
                return "start";
              }
              return "end";
              }) // horizontal offset*/
          		.text(function(d) {
          			return d.properties.Name + ", " + d.properties.Country.toUpperCase();
          		})
              .attr("class","labels")
              .attr("id", function(d){return "L"+d.properties.Etapa;});


      //adding atmosphere
      var gradient = svg.append("svg:defs")
    .append("svg:radialGradient")
    .attr("id", "gradient")
    .attr("gradientUnits", "objectBoundingBox")
  //  .attr("cx", 50)
  //  .attr("cy", 50)
  //  .attr("r", "100%")
    .attr("spreadMethod", "pad");

 gradient.append("svg:stop")
    .attr("offset", "60%")
    .attr("stop-color", "#ffffff")
    .attr("stop-opacity", 0);

gradient.append("svg:stop")
    .attr("offset", "100%")
    .attr("stop-color", "#ffffff")
    .attr("stop-opacity", 0.5);

   g.append("path")
    .datum({type: "Sphere"})
    .attr("class", "atmosfera")
    .attr("d", path)
    .attr("fill", 'url(#gradient)');

     };

///// EMPEZAR CON LAS ACCIONES DEL SCROLLING /////
     d3.graphScroll()
       .offset(-3000)
      // .offset(innerWidth < 900 ? innerHeight - 30 : 200)
       .sections(d3.selectAll('#viaje > div'))
       .on('active', function(i){
         d3.select(".paradas graph-scroll-active");
         moveMap(i);
         });

    function moveMap(i){

///// FUNCIONES DE MOVIMIENTO /////
var j = i-1;
var nombrePais = camino[i].Pais;
var nombreCiudad = camino[i].Ciudad;
var nombreEtapa = camino[i].Etapas;
if (j>=0) {
  var nombreEtapaPrevia = camino[j].Etapas;
}


  // Store the current rotation and scale:
  var currentRotate = projection.rotate();

  // Calculate the future bounding box after applying a rotation:
  projection.rotate(camino[i].Coordenadas);
  path.projection(projection);

  // calculate the scale and translate required:

  var nextRotate = projection.rotate();

  // Update the map:
  d3.selectAll("path")
   .transition()
   .attrTween("d", function(d) {
      var r = d3.interpolate(currentRotate, nextRotate);
    //  var s = d3.interpolate(currentScale, nextScale);
        return function(t) {
          projection
            .rotate(r(Math.pow(t,0.33)))
            //.scale( currentScale > nextScale ? s(Math.pow(t,0.1)) : s(Math.pow(t,3)) );
          path.projection(projection);
          return path(d);
        }
   })
   .duration(1000)
   .on("end", dibujarRuta);

   //actualizar cities
     g.selectAll(".cities")
     .transition()
     .attr("cx", function(d) {return projection(d.geometry.coordinates)[0];})
     .attr("cy", function(d) {return projection(d.geometry.coordinates)[1];})
     .duration(1000);

    //actualizar labels
      g.selectAll(".labels")
      .transition()
      .attr("x", function(d){return projection(d.geometry.coordinates)[0];})
      .attr("y", function(d){return projection(d.geometry.coordinates)[1];})
      .duration(1000);



////////FUNCIONES DE ANIMACION/////////

// Restablecer las cosas
  d3.selectAll(".labels").style("opacity", "0")
  d3.selectAll(".cities").style("opacity", "0")
  d3.selectAll(".rutas").style("opacity", "0")
  d3.selectAll(".pais").style("fill", "#FFD2C8")


    d3.select("#"+nombrePais)
    .transition()
    .style("fill", "#FFA69E")
    .delay(1000)
    .duration(500);

function dibujarRuta(){
    if (d3.select("#"+nombreEtapa).node() !== null) {
     var totalLength = d3.select("#"+nombreEtapa).node().getTotalLength();
      g.selectAll("#"+nombreEtapa)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
      .style("opacity", "1")
      .attr("stroke-dashoffset", 0)
      .duration(1000);
    }};

    g.selectAll("#L"+nombreEtapa)
    .transition()
    .attr("x", function(d){return projection(d.geometry.coordinates)[0];})
    .attr("y", function(d){return projection(d.geometry.coordinates)[1];})
    .style("opacity", "1")
    .delay(1000)
    .duration(500);

    d3.selectAll("#C"+nombreEtapa)
    .transition()
    .attr("x", function(d){return projection(d.geometry.coordinates)[0];})
    .attr("y", function(d){return projection(d.geometry.coordinates)[1];})
    .style("opacity", "1")
    .delay(1000)
    .duration(500);

    if (![2,3,4].includes(j)) {
      d3.selectAll("#C"+nombreEtapaPrevia)
      .transition()
      .attr("x", function(d){return projection(d.geometry.coordinates)[0];})
      .attr("y", function(d){return projection(d.geometry.coordinates)[1];})
      .style("opacity", "1")
      .delay(1000)
      .duration(500);
    }

 };


</script>

  </body>
</html>
